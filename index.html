<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Global Realtor Circle | Agent Certification</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ü‡¶ó‡ßá‡¶∞ ‡¶∏‡¶¨ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶•‡¶æ‡¶ï‡¶¨‡ßá */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Poppins:wght@300;400;600&display=swap');
        :root { --gold: #d4af37; --navy: #0a192f; --dark-blue: #112240; --white: #ffffff; --gray: #8892b0; --success: #64ffda; }
        body { font-family: 'Poppins', sans-serif; margin: 0; background-color: #f4f7f9; color: var(--navy); }
        header { background: linear-gradient(rgba(10, 25, 47, 0.9), rgba(10, 25, 47, 0.9)), url('https://images.unsplash.com/photo-1560518883-ce09059eeffa?auto=format&fit=crop&w=1500'); background-size: cover; background-position: center; color: var(--white); padding: 80px 20px; text-align: center; border-bottom: 5px solid var(--gold); }
        header h1 { font-family: 'Playfair Display', serif; font-size: 3.5rem; margin: 0; }
        .badge { display: inline-block; background: var(--gold); color: var(--navy); padding: 5px 20px; border-radius: 50px; font-weight: 700; margin-top: 15px; font-size: 0.9rem; }
        .container { max-width: 1000px; margin: -60px auto 60px; padding: 0 20px; }
        .main-card { background: var(--white); border-radius: 20px; box-shadow: 0 20px 50px rgba(0,0,0,0.15); padding: 40px; border-top: 5px solid var(--gold); }
        .input-group { margin-bottom: 20px; }
        label { display: block; font-weight: 600; margin-bottom: 8px; }
        input { width: 100%; padding: 15px; border: 2px solid #eef0f2; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        input:focus { border-color: var(--gold); outline: none; }
        .video-container { position: relative; border-radius: 15px; overflow: hidden; background: #000; }
        video { width: 100%; aspect-ratio: 16/9; display: block; }
        .video-overlay { position: absolute; inset: 0; background: rgba(10, 25, 47, 0.9); display: none; flex-direction: column; justify-content: center; align-items: center; color: var(--white); text-align: center; }
        .ended .video-overlay { display: flex; }
        .btn-gold { background: var(--gold); color: var(--navy); border: none; padding: 15px 30px; border-radius: 10px; font-weight: 700; cursor: pointer; width: 100%; font-size: 1rem; transition: 0.3s; }
        .btn-gold:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4); }
        .next-btn { display: none; background: #27ae60; color: white; margin-top: 20px; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 50px; }
        .prop-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .prop-img { height: 200px; background-size: cover; background-position: center; }
        .prop-body { padding: 20px; }
        footer { background: var(--navy); color: #ccd6f6; padding: 60px 20px; margin-top: 100px; }
        .footer-grid { max-width: 1000px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 40px; }
        .footer-col h4 { color: var(--gold); margin-bottom: 20px; }
        .footer-col a { color: inherit; text-decoration: none; }
    </style>
</head>
<body>

<header>
    <h1>Global Realtor Circle</h1>
    <div class="badge"><i class="fas fa-award"></i> A-Certified</div>
</header>

<div class="container">
    <div class="main-card">
        <div id="reg-box">
            <h2 style="text-align: center;">Agent Registration</h2>
            <form id="agentForm">
                <div class="input-group">
                    <label>Full Name</label>
                    <input type="text" name="name" id="userName" required placeholder="Enter your full name">
                </div>
                <div class="input-group">
                    <label>Email Address</label>
                    <input type="email" name="email" id="userEmail" required placeholder="Enter your email">
                </div>
                <button type="submit" class="btn-gold" id="submitBtn">Start Certification Training <i class="fas fa-arrow-right"></i></button>
            </form>
        </div>

        <div id="course-content" style="display: none;">
            <div id="welcomeBox" style="text-align: center;">
                <h2>Welcome, <span id="displayUserName" style="color: var(--gold);"></span>!</h2>
                <p>Complete all 7 lessons to unlock the final exam.</p>
                <button class="btn-gold" onclick="startCourse()">Continue Module <i class="fas fa-play"></i></button>
            </div>

            <div id="videoArea" style="display: none;">
                <h3 id="lessonTitle">Module 1: Real Estate Essentials</h3>
                <div class="video-container" id="vFrame">
                    <video id="mainVideo" controls oncontextmenu="return false;">
                        <source id="videoSource" src="" type="video/mp4">
                    </video>
                    <div class="video-overlay">
                        <i class="fas fa-check-circle fa-4x" style="color: var(--success);"></i>
                        <h2>Module Completed!</h2>
                    </div>
                </div>
                <button class="btn-gold next-btn" id="nextBtn" onclick="nextLesson()">Next Module <i class="fas fa-chevron-right"></i></button>
            </div>

            <div id="examBox" style="display: none; text-align: center;">
                <div id="examIntro">
                    <i class="fas fa-graduation-cap fa-5x" style="color: var(--gold);"></i>
                    <h2 style="color: var(--navy); margin-top: 15px;">All Modules Complete!</h2>
                    <p style="color: #666; margin-bottom: 25px;">You are eligible for the final certification exam.</p>
                    <button onclick="showForm()" class="btn-gold" style="background: var(--success); color: var(--navy);">
                        Start Final Exam üìù
                    </button>
                </div>
                <div id="formFrame" style="display: none; margin-top: 30px;">
                    <iframe src="https://docs.google.com/forms/d/e/1FAIpQLSedYZ1G9Ues75X1EPL6g92n-yHN-Yw9VnnLJuYCYDqlT9MhEg/viewform?embedded=true" width="100%" height="800" frameborder="0" marginheight="0" marginwidth="0">Loading‚Ä¶</iframe>
                </div>
            </div>
        </div>
    </div>
    
    <div class="grid">
        <div class="prop-card">
            <div class="prop-img" style="background-image: url('https://images.unsplash.com/photo-1512917774080-9991f1c4c750?auto=format&fit=crop&w=500');"></div>
            <div class="prop-body">
                <h4 style="color: var(--gold);">$1,250,000</h4>
                <h4>Luxury Skyline Villa</h4>
                <p><i class="fas fa-map-marker-alt"></i> Dubai, UAE</p>
            </div>
        </div>
        <div class="prop-card">
            <div class="prop-img" style="background-image: url('https://images.unsplash.com/photo-1600585154340-be6161a56a0c?auto=format&fit=crop&w=500');"></div>
            <div class="prop-body">
                <h4 style="color: var(--gold);">$850,000</h4>
                <h4>The Green Estate</h4>
                <p><i class="fas fa-map-marker-alt"></i> New York, USA</p>
            </div>
        </div>
    </div>
</div>

<footer>
    <div class="footer-grid">
        <div class="footer-col">
            <h4>Global Realtor Circle</h4>
            <p>A Certified.</p>
            <p><i class="fab fa-facebook"></i> @globalrealtorcircle</p>
        </div>
        <div class="footer-col">
            <h4>Contact Info</h4>
            <p><i class="fas fa-phone"></i> +880 1631141100</p>
            <p><i class="fab fa-whatsapp"></i> +880 1631141100</p>
            <p><i class="fas fa-envelope"></i> globalrealtorcircle@gmail.com</p>
        </div>
        <div class="footer-col">
            <h4>Links</h4>
            <p><a href="https://globalrealtorcircle.com">Official Website</a></p>
        </div>
    </div>
    <p style="text-align: center; margin-top: 40px; font-size: 0.8rem; opacity: 0.6;">&copy; 2026 Global Realtor Circle. All Rights Reserved.</p>
</footer>

<script>
    const scriptURL = 'https://script.google.com/macros/s/AKfycbxQtpwfs62d56Ll7ehahIj2NkjktdSjgBa1Iq_dcoRhJ6NL9_g8kU-3QiJaiEHNEeOgKA/exec';
    const form = document.getElementById('agentForm');
    const videos = [
        { title: "Module 1: Real Estate Essentials", src: "What_is_Real_Estate.mp4" },

    ];

    let currentIdx = 0;

    // --- ‡¶∞‡¶ø‡¶´‡ßç‡¶∞‡ßá‡¶∂ ‡¶™‡ßç‡¶∞‡ßã‡¶ü‡ßá‡¶ï‡¶∂‡¶® ‡¶≤‡¶ú‡¶ø‡¶ï ---
    window.onload = function() {
        const sessionActive = localStorage.getItem('isLoggedIn');
        const savedIndex = localStorage.getItem('currentModuleIndex');
        const savedName = localStorage.getItem('agentName');

        if (sessionActive === 'true') {
            document.getElementById('reg-box').style.display = 'none';
            document.getElementById('course-content').style.display = 'block';
            document.getElementById('displayUserName').innerText = savedName || "Agent";
            
            if (savedIndex) {
                currentIdx = parseInt(savedIndex);
                if (currentIdx >= videos.length) {
                    showFinalExamArea();
                }
            }
        }
    };

    form.addEventListener('submit', e => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        const userEmail = document.getElementById('userEmail').value.toLowerCase().trim();
        const userName = document.getElementById('userName').value;

        // ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶ö‡ßá‡¶ï (Device level)
        if (localStorage.getItem('registeredEmail') === userEmail && localStorage.getItem('isLoggedIn') !== 'true') {
            alert("This email has already been used for certification on this device.");
            return;
        }

        btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Checking...';
        btn.disabled = true;

        fetch(scriptURL, { method: 'POST', body: new FormData(form), mode: 'no-cors' })
        .then(() => {
            // ‡¶∏‡ßá‡¶∂‡¶® ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('registeredEmail', userEmail);
            localStorage.setItem('agentName', userName);
            localStorage.setItem('currentModuleIndex', '0');

            document.getElementById('reg-box').style.display = 'none';
            document.getElementById('course-content').style.display = 'block';
            document.getElementById('displayUserName').innerText = userName;
        })
        .catch(() => {
            alert("Connection error. Please try again.");
            btn.disabled = false;
            btn.innerHTML = "Start Certification Training";
        });
    });

    function startCourse() {
        document.getElementById('welcomeBox').style.display = 'none';
        document.getElementById('videoArea').style.display = 'block';
        loadVideo(currentIdx);
    }

    function loadVideo(idx) {
        const vid = document.getElementById('mainVideo');
        const source = document.getElementById('videoSource');
        
        document.getElementById('lessonTitle').innerText = videos[idx].title;
        vid.src = videos[idx].src;
        document.getElementById('vFrame').classList.remove('ended');
        document.getElementById('nextBtn').style.display = 'none';
        
        // ‡¶Æ‡¶°‡¶ø‡¶â‡¶≤ ‡¶á‡¶®‡¶°‡ßá‡¶ï‡ßç‡¶∏ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
        localStorage.setItem('currentModuleIndex', idx.toString());
        
        vid.load();
        vid.play();

        // Anti-skip logic
        let lastTime = 0;
        vid.addEventListener('timeupdate', () => {
            if (!vid.seeking) lastTime = vid.currentTime;
        });
        vid.addEventListener('seeking', () => {
            if (vid.currentTime > lastTime + 1) vid.currentTime = lastTime;
        });

        vid.onended = () => {
            document.getElementById('vFrame').classList.add('ended');
            document.getElementById('nextBtn').style.display = 'inline-block';
            if(idx === 6) document.getElementById('nextBtn').innerText = "Unlock Final Exam";
        };
    }

    function nextLesson() {
        currentIdx++;
        if(currentIdx < videos.length) {
            loadVideo(currentIdx);
        } else {
            showFinalExamArea();
        }
    }

    function showFinalExamArea() {
        localStorage.setItem('currentModuleIndex', '7'); // ‡ß≠ ‡¶Æ‡¶æ‡¶®‡ßá ‡¶∏‡¶¨ ‡¶∂‡ßá‡¶∑
        document.getElementById('videoArea').style.display = 'none';
        document.getElementById('welcomeBox').style.display = 'none';
        document.getElementById('examBox').style.display = 'block';
    }

    function showForm() {
        document.getElementById('examIntro').style.display = 'none';
        document.getElementById('formFrame').style.display = 'block';
    }
</script>
</body>
</html>